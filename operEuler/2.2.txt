#include <linux/sched.h>

BEGIN
{
  printf("使用: bpftrace ./switchcnt.bt [PID]\n");
  printf("统计某进程的切换次数，按 Ctrl-C 显示结果\n\n");
  @time = nsecs
}

kprobe:dequeue_task_fair
{
        // 学生TODO: 请添加代码
	$pid = pid;
    $target_pid = TARGET_PID; // 请将TARGET_PID替换为你想要监视的目标进程的PID

    if ($pid == $target_pid) {
        printf("进程PID %d 被调度\n", $pid);
        @sched_count++;
    }
}

END {
  @time = (nsecs-@time) / 1000000000; // 纳秒转秒
}

